# Session操作
---
## 创建Session对象的两种方式

```python
from sqlalchemy.orm import sessionmaker

#第一种,需要自己提交事务
with Session(bind=engine) as session:
	session.begin()
	try:
		session.add(some_object)
		session.add(some_other_object)
	except:
		session.rollback()
		raise 
	else:
		session.commit()

#第二种,不需要自己体积iao事务
with sessionmaker(bind=engine).begin() as session:
	session.execute()

```
---
**接下来要说的就是利用session进行增删改查等操作，暂时不涉及到fastapi**
##   1 新增对象操作
对模型对象进行新增
```python
if __name__ == '__main__':
    with sessionmaker(engine).begin() as session:
        #tips:新增数据
        emp1=Employee(
            name='张三',
            salary=2000,
            bonus=300,
            gender=GenderValue.MALE,
            entry_date=date(2026, 1, 7),
        )
        session.add(emp1)
```
查看输出结果
```bash
2026-01-07 12:28:47,686 INFO sqlalchemy.engine.Engine INSERT INTO employee (name, salary, bonus, is_leave, gender, entry_date, create_time, update_time) VALUES (%(name)s, %(salary)s, %(bonus)s, %(is_leave)s, %(gender)s, %(entry_date)s, now(), now())
2026-01-07 12:28:47,686 INFO sqlalchemy.engine.Engine [generated in 0.00013s] {'name': '张三', 'salary': 2000, 'bonus': 300, 'is_leave': 0, 'gender': 'MALE', 'entry_date': datetime.date(2026, 1, 7)}
2026-01-07 12:28:47,687 INFO sqlalchemy.engine.Engine COMMIT

```

查看数据库发现也有数据了

值得注意的是，如果批量添加数据，那么有唯一约束的再添加会失败，进而导致本次事务回滚，导致合法的数据也插入不了

**批量添加**
利用session.add_all([xxx,xxx])可以进行批量添加数据
```python
if __name__ == '__main__':
    with sessionmaker(engine).begin() as session:
        # tips:新增数据
        # emp1 = Employee(
        #     name='张三',
        #     salary=2000,
        #     bonus=300,
        #     gender=GenderValue.MALE,
        #     entry_date=date(2026, 1, 7),
        # )
        emp2 = Employee(
            name='李四',
            salary=5000,
            bonus=300,
            gender=GenderValue.FEMALE,
            entry_date=date(2026, 1, 8),
        )
        emp3 = Employee(
            name='王五',
            salary=3000,
            bonus=3000,
            gender=GenderValue.FEMALE,
            entry_date=date(2026, 1, 9),
        )
        # session.add(emp1)
        #tips:批量添加
        session.add_all([emp2,emp3])
```

**还有一种类sql的方式**
```python
from sqlalchemy.dialects.mysql import insert
#tips:方式2,类sql方式，了解为主
        inert_stmt=insert(Employee).values(name='陈六',salary=5000,bonus=300,gender=GenderValue.FEMALE,entry_date=date(2026, 1, 9))
        inert_stmt=insert(Employee).values(name='陈六',salary=5000,bonus=300,gender=GenderValue.FEMALE,entry_date=date(2026, 1, 9))
        session.execute(inert_stmt)
        
        
        batchdata=[{'name':'刘七','salary':800,'bonus':1000,'gender':GenderValue.MALE,'enntry_data':datetime(2026, 1, 9)},
                   {'name':'刘八','salary':1800,'bonus':1000,'gender':GenderValue.MALE,'enntry_data':datetime(2026, 1, 9)}]
        #批量添加
        insertbatchdata = insert(Employee)
        session.execute(insertbatchdata,batchdata)
```

## 2 查询对象操作

