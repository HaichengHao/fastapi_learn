ä½ é—®å¾—éå¸¸å¥½ï¼åˆ†é¡µæ˜¯ Web å¼€å‘ä¸­æœ€å¸¸è§çš„éœ€æ±‚ä¹‹ä¸€ã€‚æˆ‘ä»¬æ¥ç³»ç»Ÿæ¢³ç†ä¸€ä¸‹ **åŸºäº `LIMIT` å’Œ `OFFSET` çš„åˆ†é¡µè®¡ç®—é€»è¾‘**ï¼ŒåŒ…æ‹¬å…¬å¼ã€å®ç°æ–¹å¼å’Œæ³¨æ„äº‹é¡¹ã€‚

---

## ğŸ“ æ ¸å¿ƒåˆ†é¡µå…¬å¼

å‡è®¾ï¼š
- `total` = æ€»æ•°æ®æ¡æ•°ï¼ˆä¾‹å¦‚ï¼š105 æ¡å‘˜å·¥è®°å½•ï¼‰
- `page_size`ï¼ˆæˆ– `per_page`ï¼‰= æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡ï¼ˆä¾‹å¦‚ï¼š10 æ¡/é¡µï¼‰
- `page` = å½“å‰é¡µç ï¼ˆé€šå¸¸ä» 1 å¼€å§‹ï¼‰

### âœ… 1. **æ€»é¡µæ•°ï¼ˆtotal_pagesï¼‰**
```python
import math

total_pages = math.ceil(total / page_size)
```

> ğŸ”¢ ä¾‹å­ï¼š  
> - `total=105`, `page_size=10` â†’ `105 / 10 = 10.5` â†’ `ceil(10.5) = 11` é¡µ  
> - `total=100`, `page_size=10` â†’ `10` é¡µ

âœ… **è¿™æ˜¯æœ€å…³é”®çš„å…¬å¼ï¼**

---

### âœ… 2. **OFFSET å’Œ LIMIT çš„è®¡ç®—**

SQL ä¸­åˆ†é¡µç”¨ï¼š
```sql
SELECT * FROM employee
ORDER BY id
LIMIT :page_size OFFSET :offset;
```

å…¶ä¸­ï¼š
- `LIMIT = page_size`
- `OFFSET = (page - 1) * page_size`

> ğŸ”¢ ä¾‹å­ï¼ˆpage_size=10ï¼‰ï¼š
> - ç¬¬ 1 é¡µï¼š`OFFSET = (1-1)*10 = 0`
> - ç¬¬ 2 é¡µï¼š`OFFSET = (2-1)*10 = 10`
> - ç¬¬ 3 é¡µï¼š`OFFSET = 20`
> - ...
> - ç¬¬ 11 é¡µï¼š`OFFSET = 100`

---

## ğŸ§© åœ¨ SQLAlchemy ä¸­çš„å®Œæ•´åˆ†é¡µç¤ºä¾‹

```python
from sqlalchemy import select, func
from math import ceil

def get_paginated_employees(session, page: int = 1, page_size: int = 10):
    # 1. è·å–æ€»æ¡æ•°
    total = session.execute(select(func.count(Employee.id))).scalar()
    
    # 2. è®¡ç®—æ€»é¡µæ•°
    total_pages = ceil(total / page_size) if total > 0 else 0
    
    # 3. è®¡ç®— offset
    offset = (page - 1) * page_size
    
    # 4. æŸ¥è¯¢å½“å‰é¡µæ•°æ®
    stmt = select(Employee).order_by(Employee.id).limit(page_size).offset(offset)
    items = session.execute(stmt).scalars().all()
    
    return {
        "items": items,
        "total": total,
        "page": page,
        "page_size": page_size,
        "total_pages": total_pages,
        "has_next": page < total_pages,
        "has_prev": page > 1,
    }
```

è°ƒç”¨ï¼š
```python
result = get_paginated_employees(session, page=2, page_size=10)
print(f"ç¬¬ {result['page']} é¡µï¼Œå…± {result['total_pages']} é¡µ")
for emp in result["items"]:
    print(emp.name)
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹ & å¸¸è§å‘

### 1. **`func.count()` vs `func.count(Employee.id)`**
- æ¨èç”¨ `func.count(Employee.id)`ï¼ˆæˆ–ä¸»é”®ï¼‰ï¼Œé¿å… `NULL` å¹²æ‰°
- ä¸è¦ç”¨ `func.count('*')`ï¼ˆSQLAlchemy ä¸æ”¯æŒç›´æ¥å†™ `'*'`ï¼‰

âœ… æ­£ç¡®ï¼š
```python
select(func.count(Employee.id))
```

### 2. **é¡µç è¾¹ç•Œå¤„ç†**
- å¦‚æœ `page=0` æˆ–è´Ÿæ•°ï¼Ÿâ†’ åº”è¯¥æŠ¥é”™æˆ–é»˜è®¤ä¸º 1
- å¦‚æœ `page > total_pages`ï¼Ÿâ†’ è¿”å›ç©ºåˆ—è¡¨ï¼Œä½†ä¿ç•™å…ƒä¿¡æ¯

### 3. **æ€§èƒ½é—®é¢˜ï¼ˆå¤§æ•°æ®é‡ï¼‰**
- `OFFSET` è¶Šå¤§ï¼ŒæŸ¥è¯¢è¶Šæ…¢ï¼ˆæ•°æ®åº“è¦è·³è¿‡å‰é¢æ‰€æœ‰è¡Œï¼‰
- è¶…è¿‡å‡ ä¸‡æ¡åï¼Œå»ºè®®æ”¹ç”¨ **æ¸¸æ ‡åˆ†é¡µï¼ˆCursor-based Paginationï¼‰**ï¼Œæ¯”å¦‚åŸºäº `id > last_seen_id`

> æ¸¸æ ‡åˆ†é¡µç¤ºä¾‹ï¼ˆé€‚åˆâ€œä¸‹ä¸€é¡µâ€åœºæ™¯ï¼‰ï¼š
> ```python
> # ä¸Šä¸€é¡µæœ€åä¸€æ¡çš„ id æ˜¯ 1000
> stmt = select(Employee).where(Employee.id > 1000).order_by(Employee.id).limit(10)
> ```

### 4. **å‰ç«¯ä¼ å‚å»ºè®®**
- URL å‚æ•°é€šå¸¸ç”¨ï¼š`?page=2&page_size=10`
- é™åˆ¶ `page_size` æœ€å¤§å€¼ï¼ˆå¦‚ â‰¤ 100ï¼‰ï¼Œé˜²æ­¢æ¶æ„è¯·æ±‚

---

## ğŸ“¦ å°è£…æˆé€šç”¨åˆ†é¡µå·¥å…·ï¼ˆå¯é€‰ï¼‰

ä½ å¯ä»¥å†™ä¸€ä¸ªé€šç”¨å‡½æ•°ï¼š

```python
def paginate(query, session, page=1, page_size=10):
    total = session.execute(select(func.count()).select_from(query.subquery())).scalar()
    items = session.execute(
        query.limit(page_size).offset((page - 1) * page_size)
    ).scalars().all()
    return {
        "items": items,
        "total": total,
        "pages": ceil(total / page_size) if total else 0,
        "page": page,
    }
```

ä½¿ç”¨ï¼š
```python
query = select(Employee).where(Employee.salary > 5000)
result = paginate(query, session, page=1, page_size=5)
```

---

## âœ… æ€»ç»“ï¼šè®°ä½è¿™ 3 ä¸ªæ ¸å¿ƒå…¬å¼

| ç›®çš„ | å…¬å¼ |
|------|------|
| **æ€»é¡µæ•°** | `total_pages = ceil(total / page_size)` |
| **OFFSET** | `offset = (page - 1) * page_size` |
| **LIMIT** | `limit = page_size` |

åªè¦æŒæ¡è¿™ä¸‰ç‚¹ï¼Œæ‰‹åŠ¨åˆ†é¡µå°±å®Œå…¨æ²¡é—®é¢˜äº†ï¼

å¦‚æœä½ ç”¨çš„æ˜¯ **FastAPI + Pydantic**ï¼Œè¿˜å¯ä»¥è¿”å›æ ‡å‡†åŒ–åˆ†é¡µå“åº”æ¨¡å‹ï¼Œéœ€è¦æˆ‘è¡¥å……å—ï¼ŸğŸ˜Š