from employee.models import Employeefrom employee.models import Employee

# 定义模型类  
这种模型类结构成为声明式映射,它同时定义了python对象模型,以及描述的数据库元数据再特定数据库中存在或将要存在的真实数据库表

## 构造引擎(同步引擎,暂时未使用异步)
**db_main.py**
```python
from sqlalchemy.engine import create_engine

engine = create_engine( #tips:这里我们先用同步阻塞
    url='mysql+pymysql://niko:HHCzio20@localhost:3306/fastapidb4',
    echo=False
)

```

## 创建表
**models.py**
```python
import enum
from datetime import datetime
from decimal import Decimal



from db_main   import engine
# from ..db_main import Base# tips:from sqlalchemy.orm import DeclarativeBase as Base 不想用自己修改的Base的话就引入这个直接
from sqlalchemy.orm import Mapped,mapped_column,DeclarativeBase
from sqlalchemy import create_engine,DateTime,func,String,DECIMAL,Boolean,Enum as SAEnum
from sqlmodel import SQLModel,Field





# ✅ 1. 纯净的 Base（不包含任何字段！）
class Base(DeclarativeBase):
    pass  # ← 必须为空！


# ✅ 2. 公共字段用 Mixin 类
class TimestampMixin:
    create_time: Mapped[datetime] = mapped_column(
        DateTime,
        insert_default=func.now(),
        comment='记录创建的时间'
    )
    update_time: Mapped[datetime] = mapped_column(
        DateTime,
        insert_default=func.now(),
        onupdate=func.now(),
        comment='记录修改时间'
    )


class GenderValue(enum.Enum):
    '''通过枚举设置字段'''
    MALE = '男'
    FEMALE = '女'


#tips:这是sqlalchemy写法，其实可以用sqlmodel的写法也可以
class Employee(Base,TimestampMixin):
    __tablename__ = 'employee'
    id:Mapped[int]=mapped_column(primary_key=True,autoincrement=True)
    name:Mapped[str]=mapped_column(String(40),unique=True,nullable=False)
    salary:Mapped[Decimal]=mapped_column(DECIMAL(10,2),nullable=False,comment='员工薪资')
    bonus:Mapped[int]=mapped_column(default=0,comment='员工奖金')
    is_leave:Mapped[bool]=mapped_column(Boolean,default=False,comment="员工是否离职，默认不离职")
    gender:Mapped[GenderValue]=mapped_column(SAEnum(GenderValue),nullable=False) #tips:利用枚举类来自动匹配


```
## 之后生成表
```python
#tips:先学会阻塞同步
if __name__ == '__main__':
    Base.metadata.create_all(engine)#tips:利用这个来创建表
```


![img.png](img.png)

--- 


## 补充操作
1. 删除表
```python
Base.meta.drop_all(engine)
```
2. 单独创建和删除表
```python
Employee.__table__.drop(engine)
Employee.__table__.create(engine)
```