你问得非常好，而且你的观察非常准确！✅

---

### ✅ **结论一句话：**

> **FastAPI（异步应用）用 `postgresql+asyncpg://...` 是完全正确的；  
> 但 Alembic（同步工具）必须用 `postgresql+psycopg2://...`。**

两者可以共存于同一个项目，**只是不能混用驱动**。

---

### 🔍 详细解释

#### 1. **你的 FastAPI 应用（main.py + lifespan）✅ 正确**
- 你使用了：
  ```python
  create_async_engine(url=Config.DATABASE_URL)  # DATABASE_URL = postgresql+asyncpg://...
  ```
- 并在 `lifespan` 中调用 `await init_db()`，这是标准的 **异步初始化数据库** 方式。
- 日志显示成功创建了表、枚举类型等，说明 **`asyncpg` 工作正常**。
- ✅ 这是 **推荐做法**：FastAPI 异步应用 + SQLAlchemy Core/ORM 异步模式 + `asyncpg`。

---

#### 2. **Alembic 为什么不能用 `asyncpg` ❌**
- Alembic 是一个 **纯同步** 的迁移工具。
- 它内部调用的是 SQLAlchemy 的 **同步连接接口**（如 `engine.connect()`），而 `asyncpg` 只支持 `await engine.connect()`。
- 当你给 Alembic 配置 `postgresql+asyncpg://...` 时，SQLAlchemy 会尝试在同步上下文中调用异步函数（比如 `await_only()`），但没有 asyncio loop 或 greenlet 上下文，于是报错：
  ```
  sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called...
  ```

> 📌 **关键点**：`asyncpg` 只能在 `async/await` 环境中使用；Alembic 不是 async 程序。

---

### ✅ 正确项目结构建议（你已经在这么做了！）

| 文件/用途         | 数据库 URL 驱动        | 说明 |
|------------------|----------------------|------|
| `main.py` (FastAPI app) | `postgresql+asyncpg://...` | 异步，高性能 |
| `.env` 或 `config.py`   | 可同时定义两个 URL       | 如 `DATABASE_URL_ASYNC` 和 `DATABASE_URL_SYNC` |
| `alembic.ini` 或 `env.py` | `postgresql+psycopg2://...` | 同步，供 Alembic 使用 |

---

### 🛠️ 实际操作建议

#### 在 `.env` 中定义两个 URL：
```env
# .env
DATABASE_URL_ASYNC=postgresql+asyncpg://postgres:HHCzio20.@localhost:5432/fsdb
DATABASE_URL_SYNC=postgresql+psycopg2://postgres:HHCzio20.@localhost:5432/fsdb
```

#### 在 `config.py` 中：
```python
import os
from dotenv import load_dotenv

load_dotenv()

class Config:
    DATABASE_URL = os.getenv("DATABASE_URL_ASYNC")  # 给 FastAPI 用
    DATABASE_URL_SYNC = os.getenv("DATABASE_URL_SYNC")  # 给 Alembic 用
```

#### 在 `alembic/env.py` 中强制使用同步 URL：
```python
# alembic/env.py
from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context
from src.models import Base  # 你的模型
from config import Config   # 导入配置

# 覆盖 alembic.ini 中的 url，确保是同步的！
context.config.set_main_option("sqlalchemy.url", Config.DATABASE_URL_SYNC)

# ...其余代码不变...
```

或者直接写死（简单项目）：
```python
context.config.set_main_option(
    "sqlalchemy.url",
    "postgresql+psycopg2://postgres:HHCzio20.@localhost:5432/fsdb"
)
```

---

### 🧪 验证是否成功

运行：
```bash
alembic revision --autogenerate -m "init"
alembic upgrade head
```
如果不再报 `MissingGreenlet`，且能生成 migration 文件，就说明成功了！

---

### 💡 补充：为什么不全用 `psycopg2`？

- `asyncpg` 比 `psycopg2` **快很多**（尤其在高并发异步场景）。
- FastAPI 的优势就在于异步非阻塞，搭配 `asyncpg` 才能发挥最大性能。
- Alembic 只在开发/部署时偶尔运行一次，用同步驱动完全没问题。

---

### ✅ 总结

| 场景             | 驱动           | 是否正确 |
|------------------|---------------|--------|
| FastAPI 异步应用   | `asyncpg`     | ✅ 正确 |
| Alembic 迁移工具   | `psycopg2`    | ✅ 必须 |
| 把 `asyncpg` 给 Alembic | ❌            | 会报 `MissingGreenlet` |

你现在的 FastAPI 代码 **完全没问题**，只需要 **单独为 Alembic 配一个同步 URL** 即可。

需要我帮你改写 `alembic/env.py` 吗？