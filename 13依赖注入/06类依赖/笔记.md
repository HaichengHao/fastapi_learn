# 类依赖

在fastapi中，类依赖注入允许我们使用类作为依赖项，而不仅仅是函数。   
这种方式特别适合封装复杂逻辑或需要维护状态的场景，例如:  
- 数据库服务(封装CRUD操作)
- 外部api客户端(封装HTTP请求)
- 管理配置(读取和缓存配置)

*特点* 
1. 面向对象：可以封装属性和方法
2. 可复用性：类实例可以在多个路由中共享
3. 依赖嵌套：类可以依赖其他类或函数
4. 支持初始化参数：可以通过__init__传递配置

- 示例代码
```python

from fastapi  import FastAPI,Depends
from typing import Annotated


class UserService:
    def __init__(self,db_connection:str):
        self.db_connection = db_connection

    def get_user(self,userid:int):
        return {
            'userid':userid,
            'db_connection':self.db_connection
        }


def get_user_service():
    return UserService(db_connection='mysql://niko:HHCzio20@localhost:3306/stusys')

app = FastAPI()

@app.get('/users/{userid}')
async def read_users(userid:int,user_service:Annotated[UserService,Depends(get_user_service)]):
    return user_service.get_user(userid)

```

![img.png](img.png)