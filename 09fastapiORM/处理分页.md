#  fastapi_pagination  

ä½ ç°åœ¨çš„é”™è¯¯æ˜¯ï¼š

```
fastapi_pagination.errors.UninitializedConfigurationError: Use params, add_pagination or pagination_ctx
```

ä½†ä½  **å·²ç»è°ƒç”¨äº† `add_pagination(app)`**ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šæŠ¥é”™ï¼Ÿ

---

## ğŸ” é—®é¢˜æ ¹æº

ä½ çš„è·¯ç”±å‡½æ•°ç­¾åå’Œè¿”å›ç±»å‹ **ä¸ `fastapi-pagination` çš„ä½¿ç”¨æ–¹å¼ä¸åŒ¹é…**ã€‚

### âŒ é”™è¯¯å†™æ³•ï¼ˆå½“å‰ä»£ç ï¼‰ï¼š
```python
@app.get('/stuall', response_model=list[BaseStuinfo])
async def get() -> Page[Studentinfo]:
    allstu = await Student.all()
    return paginate(allstu)
```

è¿™é‡Œæœ‰ **3 ä¸ªå…³é”®é—®é¢˜**ï¼š

1. **`response_model=list[BaseStuinfo]` å’Œ `-> Page[Studentinfo]` å†²çª**  
   - `Page[T]` æ˜¯ä¸€ä¸ªåŒ…å« `items: List[T]`, `total`, `page`, `size` ç­‰å­—æ®µçš„ç»“æ„ä½“
   - ä½†ä½ å‘Šè¯‰ FastAPI å“åº”æ˜¯ `list[BaseStuinfo]`ï¼Œè¿™ä¼šå¯¼è‡´ç±»å‹ä¸ä¸€è‡´

2. **`paginate()` ä¸èƒ½ç›´æ¥ç”¨äºå¼‚æ­¥æŸ¥è¯¢ç»“æœï¼ˆå¦‚ `await Student.all()`ï¼‰**  
   - `fastapi-pagination` çš„é»˜è®¤ `paginate()` æ˜¯ä¸º **åŒæ­¥å¯è¿­ä»£å¯¹è±¡** è®¾è®¡çš„ï¼ˆæ¯”å¦‚ listï¼‰
   - è€Œ Tortoise ORM æŸ¥è¯¢è¿”å›çš„æ˜¯ **QuerySet**ï¼Œéœ€è¦ä½¿ç”¨ **Tortoise ä¸“ç”¨æ‰©å±•**

3. **æœªä½¿ç”¨ `fastapi_pagination.ext.tortoise` çš„åˆ†é¡µå™¨**

---

## âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ `fastapi-pagination` + Tortoise æ‰©å±•

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…ï¼ˆå¦‚æœè¿˜æ²¡è£…ï¼‰
```bash
pip install fastapi-pagination
# Tortoise æ”¯æŒå·²å†…ç½®ï¼Œæ— éœ€é¢å¤–å®‰è£…
```

> âœ… `fastapi-pagination` ä» v0.12+ å¼€å§‹åŸç”Ÿæ”¯æŒ Tortoise ORMï¼Œ**ä¸éœ€è¦ `tortoise-orm-pagination`**

---

### ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ä»£ç 

#### âœ… 1. å¯¼å…¥æ­£ç¡®çš„åˆ†é¡µå·¥å…·
```python
from fastapi_pagination import add_pagination, Page
from fastapi_pagination.ext.tortoise import paginate  # â† å…³é”®ï¼ç”¨è¿™ä¸ª paginate
```

> æ³¨æ„ï¼š**ä¸æ˜¯ `from fastapi_pagination import paginate`**ï¼Œè€Œæ˜¯ **`from fastapi_pagination.ext.tortoise import paginate`**

#### âœ… 2. ä¿®æ­£è·¯ç”±å‡½æ•°

```python
@app.get('/stuall', response_model=Page[BaseStuinfo])  # â† å“åº”æ¨¡å‹æ˜¯ Page[...]
async def get() -> Page[BaseStuinfo]:  # â† è¿”å›ç±»å‹ä¸€è‡´
    return await paginate(Student)  # â† ç›´æ¥ä¼ æ¨¡å‹ç±»ï¼Œä¸è¦ .all()
```

> âœ¨ `paginate(Student)` ä¼šè‡ªåŠ¨å¤„ç†åˆ†é¡µå‚æ•°ï¼ˆ`page`, `size`ï¼‰ï¼Œå¹¶è¿”å› `Page[BaseStuinfo]`

---

### âœ… å®Œæ•´ä¿®æ­£åçš„ `/stuall` è·¯ç”±ï¼š

```python
from fastapi_pagination import add_pagination, Page
from fastapi_pagination.ext.tortoise import paginate  # â† é‡ç‚¹ï¼

# ... å…¶ä»–ä»£ç  ...

@app.get('/stuall', response_model=Page[BaseStuinfo])
async def get() -> Page[BaseStuinfo]:
    return await paginate(Student)
```

---

### âœ… åŒæ—¶ç¡®ä¿ `add_pagination(app)` å·²è°ƒç”¨ï¼ˆä½ å·²ç»åšäº†ï¼‰

```python
app = FastAPI()
add_pagination(app)  # âœ… æ­£ç¡®ä½ç½®
```

---

## ğŸ“Œ è¡¥å……è¯´æ˜

- `fastapi_pagination.ext.tortoise.paginate` æ¥æ”¶çš„æ˜¯ **Tortoise æ¨¡å‹ç±»**ï¼ˆå¦‚ `Student`ï¼‰æˆ– **QuerySet**
- å®ƒä¼šè‡ªåŠ¨ä»è¯·æ±‚ä¸­è¯»å– `page` å’Œ `size`ï¼ˆé»˜è®¤ `size=50`ï¼Œå¯é€šè¿‡ `Params` è‡ªå®šä¹‰ï¼‰
- è¿”å›çš„æ˜¯ `Page[BaseStuinfo]`ï¼Œç»“æ„å¦‚ä¸‹ï¼š
  ```json
  {
    "items": [{"stuid": 1, "name": "å¼ ä¸‰", "age": 20}, ...],
    "total": 100,
    "page": 1,
    "size": 50,
    "pages": 2
  }
  ```

---

## ğŸ›  å¦‚æœä½ æƒ³è‡ªå®šä¹‰æ¯é¡µæ•°é‡

```python
from fastapi_pagination import Params

@app.get('/stuall', response_model=Page[BaseStuinfo])
async def get(params: Params = Params(page=1, size=10)):
    return await paginate(Student, params=params)
```

æˆ–è€…è®©å‰ç«¯ä¼  `?page=1&size=10`ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨è§£æã€‚

---

## âœ… æœ€ç»ˆå»ºè®®çš„å®Œæ•´å¯¼å…¥éƒ¨åˆ†

```python
from typing import Annotated
from fastapi import FastAPI, Form, HTTPException
from fastapi_pagination import add_pagination, Page, Params
from fastapi_pagination.ext.tortoise import paginate  # â† å…³é”®ï¼

from models import *
from tortoise.contrib.fastapi import register_tortoise
from pydantic import BaseModel, Field
```

---

## âœ… æ€»ç»“

| é—®é¢˜ | ä¿®å¤æ–¹å¼ |
|------|--------|
| `UninitializedConfigurationError` | å®é™…æ˜¯ç”¨é”™äº† `paginate` å‡½æ•° |
| åˆ†é¡µå¤±è´¥ | æ”¹ç”¨ `from fastapi_pagination.ext.tortoise import paginate` |
| å“åº”æ¨¡å‹å†²çª | `response_model=Page[BaseStuinfo]`ï¼Œä¸æ˜¯ `list[...]` |
| ä¼ å…¥äº† list | ä¸è¦ `await Student.all()`ï¼Œç›´æ¥ä¼  `Student` |

---

ç°åœ¨ä½ çš„ `/stuall` æ¥å£åº”è¯¥å¯ä»¥æ­£å¸¸è¿”å›åˆ†é¡µæ•°æ®äº†ï¼å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œæ¬¢è¿ç»§ç»­è´´æ—¥å¿—ã€‚