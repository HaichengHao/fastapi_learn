## 笔记

### 先要写好tortoise的配置
```python
from fastapi import FastAPI
from typing import Annotated, Dict
from tortoise.contrib.fastapi import register_tortoise

# tips:数据库配置 非常像django中的写法
Tortoise_orm: Dict = {
    'connections': {
        'default': 'mysql://niko:HHCzio20@localhost:3306/fastapidb'

    },
    'apps': {
        'models': {
            # 'models': ['app.models', 'aerich.models'],  # tips 模型板块和Aerich迁移模型
            'models': ['usermodel','aerich.models'],  # tips 模型板块和Aerich迁移模型,这里使用我自己写的usermodel
            'default_connection': 'default',  # tips:指定使用我们上面定义的默认数据库连接
        }
    },
    # important:连接池配置(推荐)
    'use_tz': False,  # 是否使用时区
    'timezone': 'UTC',  # 默认时区
    'db_pool': {
        'max_size': 10,  # 最大连接数
        'min_size': 1,  # 最小连接数
        'idle_timeout': 30,  # 空闲连接超时(秒)
    }
}

app = FastAPI()

register_tortoise(
    app, config=Tortoise_orm,
    generate_schemas=True,
    add_exception_handlers=True)  # tips:调用参数对app进行数据库配置,并指定生成schemas,且添加异常处理器

```
### 然后可以写我们的模型  
> 注意名字一定要和上面`'models': ['usermodel','aerich.models']`中自己定义的保持一致  

```python

from tortoise.models import Model
from tortoise.fields import CharField,DatetimeField,BooleanField,IntField

class  User(Model):
    id = CharField(max_length=30,primary_key=True) #tips:uuid主键
    username = CharField(max_length=20,unique=True)
    email = CharField(max_length=255,unique=True)
    is_active = BooleanField(default=True)
    created_at = DatetimeField(auto_now_add=True) #创建时间
    updated_at = DatetimeField(auto_now=True)
    class Meta:
        table='user'
    def __str__(self):
        return self.username

```

### 之后就是进行初始化和迁移操作

```bash
(.venvs) nikofox@MOSS:~/fastapi_learn/09fastapiORM/01基础部分/02Aerich迁移工具的使用$ aerich init -t config.Tortoise_orm
Success writing aerich config to pyproject.toml
Success creating migrations folder ./migrations

(.venvs) nikofox@MOSS:~/fastapi_learn/09fastapiORM/01基础部分/02Aerich迁移工具的使用$ aerich init-db
Success creating app migration folder migrations/models
Success generating initial migration file for app "models"
Success writing schemas to database "fastapidb"

# 如果进行了修改的话可以利用migrate进行修改迁移
(.venvs) nikofox@MOSS:~/fastapi_learn/09fastapiORM/01基础部分/02Aerich迁移工具的使用$ aerich migrate --name 'plustheid'
Success creating migration file 1_20251222100750_plustheid.py
#然后提交
(.venvs) nikofox@MOSS:~/fastapi_learn/09fastapiORM/01基础部分/02Aerich迁移工具的使用$ aerich upgrade
Success upgrading to 1_20251222100750_plustheid.py

(.venvs) nikofox@MOSS:~/fastapi_learn/09fastapiORM/01基础部分/02Aerich迁移工具的使用$ aerich history
0_20251222095643_init.py
1_20251222100750_plustheid.py     


```